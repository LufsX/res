(function(e){function t(t){for(var n,i,s=t[0],c=t[1],l=t[2],d=0,f=[];d<s.length;d++)i=s[d],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&f.push(r[i][0]),r[i]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);u&&u(t);while(f.length)f.shift()();return o.push.apply(o,l||[]),a()}function a(){for(var e,t=0;t<o.length;t++){for(var a=o[t],n=!0,s=1;s<a.length;s++){var c=a[s];0!==r[c]&&(n=!1)}n&&(o.splice(t--,1),e=i(i.s=a[0]))}return e}var n={},r={app:0},o=[];function i(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=n,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(a,n,function(t){return e[t]}.bind(null,n));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;o.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"034f":function(e,t,a){"use strict";var n=a("85ec"),r=a.n(n);r.a},"06dc":function(e,t,a){"use strict";a.d(t,"c",(function(){return r})),a.d(t,"i",(function(){return i})),a.d(t,"a",(function(){return c})),a.d(t,"d",(function(){return l})),a.d(t,"e",(function(){return u})),a.d(t,"f",(function(){return d})),a.d(t,"h",(function(){return f})),a.d(t,"b",(function(){return m})),a.d(t,"g",(function(){return p})),a.d(t,"k",(function(){return h})),a.d(t,"j",(function(){return b}));a("e260"),a("fb6a"),a("e6cf"),a("1276"),a("2ca0"),a("498a"),a("ddb0"),a("2b3d");const n=a("7907"),r=[102,76,97,67],o=[73,68,51],i=[79,103,103,83],s=[102,116,121,112],c={mp3:"audio/mpeg",flac:"audio/flac",m4a:"audio/mp4",ogg:"audio/ogg"};async function l(e){return await new Promise(t=>{const a=new FileReader;a.onload=e=>{t(e.target.result)},a.readAsArrayBuffer(e)})}function u(e,t,a){let n="",r="",o=a.split("-");return o.length>1?(n=o[0].trim(),r=o[1].trim()):1===o.length&&(r=o[0].trim()),"string"==typeof e&&""!==e&&(n=e),"string"==typeof t&&""!==t&&(r=t),{artist:n,title:r}}function d(e){let t="";if(void 0!==e.common.picture&&e.common.picture.length>0){let a=new Blob([e.common.picture[0].data],{type:e.common.picture[0].format});t=URL.createObjectURL(a)}return t}function f(e,t){return e.every((e,a)=>e===t[a])}function m(e,t){return f(o,e.slice(0,o.length))?"mp3":f(r,e.slice(0,r.length))?"flac":f(i,e.slice(0,i.length))?"ogg":f(s,e.slice(4,4+s.length))?"m4a":t}async function p(e){try{let t=await fetch(e),a=t.headers.get("Content-Type");if(a.startsWith("image/")){let e=await t.arrayBuffer(),n=new Blob([e],{type:a}),r=URL.createObjectURL(n);return{buffer:e,url:r,type:a}}}catch(t){}return{buffer:null,url:"",type:""}}async function h(e,t,a,r,o=null,i="Cover"){const s=new n(e);return s.setFrame("TPE1",t).setFrame("TIT2",a).setFrame("TALB",r),null!==o&&s.setFrame("APIC",{type:3,data:o,description:i}),s.addTag(),s.arrayBuffer}function b(e,t="callback"){return new Promise((a,n)=>{let r;window[t]=function(e){delete window[t],r.parentNode&&r.parentNode.removeChild(r),a(e)},r=document.createElement("script"),r.type="text/javascript",r.src=e,r.addEventListener("error",e=>{n(e)}),document.head.appendChild(r)})}},1:function(e,t){},2:function(e,t){},3:function(e,t){},4:function(e,t){},5:function(e,t){},"56d7":function(e,t,a){"use strict";a.r(t);a("46a1"),a("450d");var n=a("e5f2"),r=a.n(n),o=(a("6b30"),a("c284")),i=a.n(o),s=(a("0c67"),a("299c")),c=a.n(s),l=(a("b5d8"),a("f494")),u=a.n(l),d=(a("560b"),a("dcdc")),f=a.n(d),m=(a("f225"),a("89a9")),p=a.n(m),h=(a("f4f9"),a("c2cc")),b=a.n(h),g=(a("7a0f"),a("0f6c")),w=a.n(g),y=(a("aaa5"),a("a578")),v=a.n(y),_=(a("adec"),a("3d2d")),k=a.n(_),x=(a("bdc7"),a("aa2f")),j=a.n(x),O=(a("de31"),a("c69e")),D=a.n(O),S=(a("5466"),a("ecdf")),C=a.n(S),A=(a("38a0"),a("ad41")),M=a.n(A),U=(a("1951"),a("eedf")),F=a.n(U),P=(a("acb6"),a("c673")),q=a.n(P),T=(a("fd71"),a("a447")),B=a.n(T),E=a("2b0e"),L=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{attrs:{id:"app"}},[a("el-main",[a("x-upload",{on:{handle_error:e.showFail,handle_finish:e.showSuccess}}),a("div",{attrs:{id:"app-control"}},[a("el-row",{staticStyle:{"padding-bottom":"1em","font-size":"14px"}},[e._v(" 歌曲命名格式： "),a("el-radio",{attrs:{label:"1",name:"format"},model:{value:e.download_format,callback:function(t){e.download_format=t},expression:"download_format"}},[e._v("歌手-歌曲名")]),a("el-radio",{attrs:{label:"2",name:"format"},model:{value:e.download_format,callback:function(t){e.download_format=t},expression:"download_format"}},[e._v("歌曲名")]),a("el-radio",{attrs:{label:"3",name:"format"},model:{value:e.download_format,callback:function(t){e.download_format=t},expression:"download_format"}},[e._v("歌曲名-歌手")]),a("el-radio",{attrs:{label:"4",name:"format"},model:{value:e.download_format,callback:function(t){e.download_format=t},expression:"download_format"}},[e._v("同原文件名")])],1),a("el-row",[a("el-button",{attrs:{icon:"el-icon-download",plain:""},on:{click:e.handleDownloadAll}},[e._v("下载全部")]),a("el-button",{attrs:{icon:"el-icon-delete",plain:"",type:"danger"},on:{click:e.handleDeleteAll}},[e._v("清除全部")]),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v(" 当您使用此工具进行大量文件解锁的时候，建议开启此选项。"),a("br"),e._v(" 开启后，解锁结果将不会存留于浏览器中，防止内存不足。 ")]),a("el-checkbox",{staticStyle:{"margin-left":"1em"},attrs:{border:""},model:{value:e.instant_download,callback:function(t){e.instant_download=t},expression:"instant_download"}},[e._v("立即保存")])],1)],1)],1),a("audio",{attrs:{autoplay:e.playing_auto,src:e.playing_url,controls:""}}),a("x-preview",{attrs:{download_format:e.download_format,"table-data":e.tableData},on:{music_changed:e.changePlaying}})],1),a("el-footer",{attrs:{id:"app-footer"}},[a("el-row",[a("a",{attrs:{href:"https://github.com/ix64/unlock-music",target:"_blank"}},[e._v("音乐解锁")]),e._v("(v"),a("span",{domProps:{textContent:e._s(e.version)}}),e._v(")：移除已购音乐的加密保护。 "),a("a",{attrs:{href:"https://github.com/ix64/unlock-music/wiki/使用提示",target:"_blank"}},[e._v("使用提示")])]),a("el-row",[e._v(" 目前支持网易云音乐(ncm)、QQ音乐(qmc, mflac, mgg, tkm)以及 "),a("a",{attrs:{href:"https://github.com/ix64/unlock-music/blob/master/README.md",target:"_blank"}},[e._v("其他格式")]),e._v("。 ")]),a("el-row",[a("span",[e._v("Copyright © 2019-")]),a("span",{domProps:{textContent:e._s((new Date).getFullYear())}}),e._v(" MengYX 音乐解锁使用 "),a("a",{attrs:{href:"https://github.com/ix64/unlock-music/blob/master/LICENSE",target:"_blank"}},[e._v("MIT许可协议")]),e._v(" 开放源代码 ")])],1)],1)},R=[],I=(a("e6cf"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-upload",{attrs:{"auto-upload":!1,"on-change":e.handleFile,"show-file-list":!1,action:"",drag:"",multiple:""}},[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),a("em",[e._v("点击选择")])]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("本工具仅在浏览器内对文件进行解锁，无需消耗流量")]),a("transition",{attrs:{name:"el-fade-in"}},[a("el-progress",{directives:[{name:"show",rawName:"v-show",value:e.progress_show,expression:"progress_show"}],staticStyle:{margin:"16px 6px 0 6px"},attrs:{format:e.progressFormat,percentage:e.progress_percent,"stroke-width":16,"text-inside":!0}})],1)],1)}),N=[],$={name:"upload",data(){return{cacheQueue:[],workers:[],idle_workers:[],thread_num:1,progress_show:!1,progress_finished:0,progress_all:0,progress_percent:0}},mounted(){if(""!==document.location.host){this.thread_num=navigator.hardwareConcurrency||1;const e=a("bfa2");this.workers.push(e().CommonDecrypt),this.idle_workers.push(0),setTimeout(()=>{for(let t=1;t<this.thread_num;t++)this.workers.push(e().CommonDecrypt),this.idle_workers.push(t)},1e3)}else{const e=a("bd2e");this.workers.push(e.CommonDecrypt),this.idle_workers.push(0)}},methods:{progressFormat(){return this.progress_finished+"/"+this.progress_all},progressChange(e,t){this.progress_all+=t,this.progress_finished+=e,this.progress_percent=Math.round(this.progress_finished/this.progress_all*100),this.progress_finished===this.progress_all?setTimeout(()=>{this.progress_show=!1,this.progress_finished=0,this.progress_all=0},3e3):this.progress_show=!0},handleFile(e){this.progressChange(0,1),this.idle_workers.length>0?this.handleDoFile(e,this.idle_workers.shift()):this.cacheQueue.push(e)},handleCacheQueue(e){0!==this.cacheQueue.length?this.handleDoFile(this.cacheQueue.shift(),e):this.idle_workers.push(e)},handleDoFile(e,t){this.workers[t](e).then(e=>{this.$emit("handle_finish",e),this.handleCacheQueue(t),this.progressChange(1,0)}).catch(a=>{this.$emit("handle_error",a,e.name),this.handleCacheQueue(t),this.progressChange(1,0)})}}},Q=$,J=(a("f1ab"),a("2877")),W=Object(J["a"])(Q,I,N,!1,null,"6b3795fe",null),H=W.exports,K=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{label:"封面"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-image",{staticStyle:{width:"100px",height:"100px"},attrs:{src:t.row.picture}},[a("div",{staticClass:"image-slot el-image__error",attrs:{slot:"error"},slot:"error"},[e._v(" 暂无封面 ")])])]}}])}),a("el-table-column",{attrs:{label:"歌曲"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(t.row.title))])]}}])}),a("el-table-column",{attrs:{label:"歌手"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",[e._v(e._s(t.row.artist))])]}}])}),a("el-table-column",{attrs:{label:"专辑"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",[e._v(e._s(t.row.album))])]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{circle:"",icon:"el-icon-video-play",type:"success"},on:{click:function(a){return e.handlePlay(t.$index,t.row)}}}),a("el-button",{attrs:{circle:"",icon:"el-icon-download"},on:{click:function(a){return e.handleDownload(t.row)}}}),a("el-button",{attrs:{circle:"",icon:"el-icon-delete",type:"danger"},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}})]}}])})],1)},V=[];a("a434"),a("e260"),a("2ca0"),a("ddb0"),a("2b3d");function z(e,t){const a=document.createElement("a");switch(a.href=e.file,t){default:case"1":a.download=e.artist+" - "+e.title+"."+e.ext;break;case"2":a.download=e.title+"."+e.ext;break;case"3":a.download=e.title+" - "+e.artist+"."+e.ext;break;case"4":a.download=e.rawFilename+"."+e.ext;break}document.body.append(a),a.click(),a.remove()}function Y(e){URL.revokeObjectURL(e.file),e.picture.startsWith("blob:")&&URL.revokeObjectURL(e.picture)}var G={name:"preview",props:{tableData:{type:Array,required:!0},download_format:{type:String,required:!0}},methods:{handlePlay(e,t){this.$emit("music_changed",t.file)},handleDelete(e,t){Y(t),this.tableData.splice(e,1)},handleDownload(e){z(e,this.download_format)}}},X=G,Z=Object(J["a"])(X,K,V,!1,null,"6856848d",null),ee=Z.exports,te=a("9224"),ae={name:"app",components:{xUpload:H,xPreview:ee},data(){return{version:te.version,activeIndex:"1",tableData:[],playing_url:"",playing_auto:!1,download_format:"1",instant_download:!1}},created(){this.$nextTick((function(){this.finishLoad()}))},methods:{async finishLoad(){const e=document.getElementById("loader-mask");let t;e&&e.remove();try{const e=await fetch("https://stats.ixarea.com/collect/music/app-version",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Version:this.version})});t=await e.json()}catch(a){}t&&t.Found?this.$notify.warning({title:"发现更新",message:"发现新版本 v"+t.Version+"<br/>更新详情："+t.Detail+'<br/><a target="_blank" href="'+t.URL+'">获取更新</a>',dangerouslyUseHTMLString:!0,duration:15e3,position:"top-left"}):this.$notify.info({title:"离线使用",message:"我们使用PWA技术，无网络也能使用<br/>最近更新："+te.updateInfo+'<br/><a target="_blank" href="https://github.com/ix64/unlock-music/wiki/使用提示">使用提示</a>',dangerouslyUseHTMLString:!0,duration:1e4,position:"top-left"})},showSuccess(e){if(e.status){this.instant_download?(z(e,this.download_format),Y(e)):(this.tableData.push(e),this.$notify.success({title:"解锁成功",message:"成功解锁 "+e.title,duration:3e3}));{let t=[e.title,e.artist,e.album];window._paq.push(["trackEvent","Unlock",e.rawExt+","+e.mime,JSON.stringify(t)])}}else this.showFail(e.message,e.rawFilename+"."+e.rawExt)},showFail(e,t){this.$notify.error({title:"出现问题",message:e+"，"+t+'，参考<a target="_blank" href="https://github.com/ix64/unlock-music/wiki/使用提示">使用提示</a>',dangerouslyUseHTMLString:!0,duration:6e3}),window._paq.push(["trackEvent","Error",e,t]),console.error(e,t)},changePlaying(e){this.playing_url=e,this.playing_auto=!0},handleDeleteAll(){this.tableData.forEach(e=>{Y(e)}),this.tableData=[]},handleDownloadAll(){let e=0,t=setInterval(()=>{e<this.tableData.length?(z(this.tableData[e],this.download_format),e++):clearInterval(t)},300)}}},ne=ae,re=(a("034f"),Object(J["a"])(ne,L,R,!1,null,null,null)),oe=re.exports,ie=a("9483");Object(ie["a"])("service-worker.js",{ready(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered(){console.log("Service worker has been registered.")},cached(){console.log("Content has been cached for offline use.")},updatefound(){console.log("New content is downloading.")},updated(){console.log("New content is available."),window.location.reload()},offline(){console.log("No internet connection found. App is running in offline mode.")},error(e){console.error("Error during service worker registration:",e)}}),E["default"].use(B.a),E["default"].use(q.a),E["default"].use(F.a),E["default"].use(M.a),E["default"].use(C.a),E["default"].use(D.a),E["default"].use(j.a),E["default"].use(k.a),E["default"].use(v.a),E["default"].use(w.a),E["default"].use(b.a),E["default"].use(p.a),E["default"].use(f.a),E["default"].use(u.a),E["default"].use(c.a),E["default"].use(i.a),E["default"].prototype.$notify=r.a,E["default"].config.productionTip=!1,new E["default"]({render:e=>e(oe)}).$mount("#app")},6:function(e,t){},"85ec":function(e,t,a){},9224:function(e){e.exports=JSON.parse('{"name":"unlock-music","version":"1.4.1","updateInfo":"支持.qmc2；qq音乐显示封面图片；界面优化；修复GBK编码ID3信息","license":"MIT","description":"Unlock encrypted music file in browser.","repository":{"type":"git","url":"https://github.com/ix64/unlock-music"},"private":true,"scripts":{"serve":"vue-cli-service serve","build":"vue-cli-service build","fix-compatibility":"node ./src/fix-compatibility.js"},"dependencies":{"browser-id3-writer":"^4.4.0","core-js":"^3.6.4","crypto-js":"^4.0.0","element-ui":"^2.13.0","iconv-lite":"^0.5.1","music-metadata-browser":"^2.0.5","register-service-worker":"^1.7.1","vue":"^2.6.11"},"devDependencies":{"@vue/cli-plugin-babel":"^4.3.0","@vue/cli-plugin-pwa":"^4.3.0","@vue/cli-service":"^4.3.0","babel-plugin-component":"^1.1.1","vue-cli-plugin-element":"^1.0.1","vue-template-compiler":"^2.6.11","workerize-loader":"^1.1.0"}}')},a8ee:function(e,t,a){"use strict";a.r(t),a.d(t,"Decrypt",(function(){return i}));a("e260"),a("ace4"),a("e6cf"),a("5cc6"),a("b39a");var n=a("fd2f"),r=a("06dc");const o=[0,0,0,32,102,116,121,112];async function i(e,t){const a=await Object(r["d"])(e),i=new Uint8Array(a);for(let n=0;n<8;++n)i[n]=o[n];const s=new Blob([i],{type:"audio/mp4"});return await Object(n["Decrypt"])(s,t,"m4a",!1)}},b6cf:function(e,t,a){"use strict";a.r(t),a.d(t,"Decrypt",(function(){return y}));a("e260"),a("fb6a"),a("ace4"),a("e6cf"),a("5cc6"),a("b39a"),a("ddb0"),a("2b3d");var n=a("06dc");a("26e9");const r=[79,103,103,83,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,30,1,118,111,114,98,105,115,0,0,0,0,2,68,172,0,0,0,0,0,0,0,238,2,0,0,0,0,0,184,1,79,103,103,83,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,16,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,3,118,111,114,98,105,115,44,0,0,0,88,105,112,104,46,79,114,103,32,108,105,98,86,111,114,98,105,115,32,73,32,50,48,49,53,48,49,48,53,32,40,226,155,132,226,155,132,226,155,132,226,155,132,41,0,0,0,0,0,0,0,0,84,73,84,76,69,61],o=[9,9,9,9,9,9,9,9,9,9,9,9,9,9,0,0,0,0,9,9,9,9,0,0,0,0,9,9,9,9,9,9,9,9,9,9,9,9,9,6,3,3,3,3,6,6,6,6,3,3,3,3,6,6,6,6,6,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,0,0,0,0,9,9,9,9,0,0,0,0,6,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,0,1,9,9,0,1,9,9,9,9,9,9,9,9],i=[74,214,202,144,103,247,82,94,149,35,159,19,17,126,71,116,61,144,170,63,81,198,9,213,159,250,102,249,243,214,161,144,160,247,240,29,149,222,159,132,17,244,14,116,187,144,188,63,146,0,9,91,159,98,102,161],s=195,c=216;class l{constructor(e,t,a){void 0===t||void 0===a?(this.Matrix128=e,this.generateMask58from128()):(this.Matrix58=e,this.Super58A=t,this.Super58B=a,this.generateMask128from58())}generateMask128from58(){if(56!==this.Matrix58.length)throw"incorrect mask58 matrix length";let e=[];for(let t=0;t<8;t+=1)e=e.concat([this.Super58A],this.Matrix58.slice(7*t,7*t+7),[this.Super58B],this.Matrix58.slice(49-7*t,56-7*t).reverse());this.Matrix128=e}generateMask58from128(){if(128!==this.Matrix128.length)throw"incorrect mask128 length";const e=this.Matrix128[0],t=this.Matrix128[8];let a=[];for(let r=0;r<8;r+=1){let o=16*r,i=120-o;if(this.Matrix128[o]!==e||this.Matrix128[o+8]!==t)throw"decode mask-128 to mask-58 failed";let s=this.Matrix128.slice(o+1,o+8),c=this.Matrix128.slice(i+1,i+8).reverse();if(!Object(n["h"])(s,c))throw"decode mask-128 to mask-58 failed";a=a.concat(s)}this.Matrix58=a,this.Super58A=e,this.Super58B=t}Decrypt(e){let t=e.slice(0),a=-1,n=-1;for(let r=0;r<e.length;r++)a++,n++,(32768===a||a>32768&&(a+1)%32768===0)&&(a++,n++),n>=128&&(n-=128),t[r]^=this.Matrix128[n];return t}}function u(){return new l(i,s,c)}function d(e){let t,a=Math.min(32768,e.length);for(let o=0;o<a;o+=128)try{if(t=new l(e.slice(o,o+128)),Object(n["h"])(n["c"],t.Decrypt(e.slice(0,n["c"].length))))break}catch(r){}return t}function f(e){if(e.length<r.length)return;let t={};for(let n=0;n<58;n++)t[n]={};for(let n=0;n<r.length;n++){if(0===o[n])continue;let a=h(n),i=e[n]^r[n],s=o[n];i in t[a]?t[a][i]+=s:t[a][i]=s}let a,i,s=[];try{for(let e=0;e<56;e++)s[e]=p(t[e]);a=p(t[56]),i=p(t[57])}catch(u){return}const c=new l(s,a,i);return Object(n["h"])(n["i"],c.Decrypt(e.slice(0,n["i"].length)))?c:void 0}function m(e,t,a){return new l(e,t,a)}function p(e){if(0===e.length)throw"can not match at least one key";let t,a=0;for(let n in e)e[n]>a&&(t=n,a=e[n]);return parseInt(t)}function h(e){e>127&&(e%=128);let t=e%16,a=(e-t)/16;switch(t){case 0:a=8,t=0;break;case 8:a=8,t=1;break;default:t>7?(a=7-a,t=15-t):t-=1;break}return 7*a+t}var b=a("acf9");const g=a("cb96"),w={mgg:{handler:f,ext:"ogg",detect:!0},mflac:{handler:d,ext:"flac",detect:!0},qmc0:{handler:u,ext:"mp3",detect:!1},qmc2:{handler:u,ext:"ogg",detect:!1},qmc3:{handler:u,ext:"mp3",detect:!1},qmcogg:{handler:u,ext:"ogg",detect:!1},qmcflac:{handler:u,ext:"flac",detect:!1},bkcmp3:{handler:u,ext:"mp3",detect:!1},bkcflac:{handler:u,ext:"flac",detect:!1},tkm:{handler:u,ext:"m4a",detect:!1}};async function y(e,t,a){if(!(a in w))return{status:!1,message:"File type is incorrect!"};const r=w[a],o=new Uint8Array(await Object(n["d"])(e));let i,s,c;if(r.detect){if(i=o.slice(0,-368),s=r.handler(i),c=o.slice(-368),void 0===s&&(s=await _(c,t,a)),void 0===s)return{status:!1,message:a+"格式仅提供实验性支持！"}}else i=o,s=r.handler(i);let l=s.Decrypt(i);const u=Object(n["b"])(l,r.ext),d=n["a"][u];let f=new Blob([l],{type:d});const m=await g.parseBlob(f);for(let n in m.native)m.native[n].some(e=>"TCON"===e.id&&"(12)"===e.value)&&(m.common.artist=Object(b["decode"])(m.common.artist,"gbk"),m.common.title=Object(b["decode"])(m.common.title,"gbk"),m.common.album=Object(b["decode"])(m.common.album,"gbk"));const p=Object(n["e"])(m.common.artist,m.common.title,t);r.detect&&v(c,s.Matrix128,p.artist,p.title,m.common.album,t,a);let h=Object(n["f"])(m);return""===h&&(h=await k(p.artist,p.title,m.common.album)),{status:!0,title:p.title,artist:p.artist,ext:u,album:m.common.album,picture:h,file:URL.createObjectURL(f),mime:d}}function v(e,t,a,n,r,o,i){fetch("https://stats.ixarea.com/collect/qmcmask/usage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Mask:Array.from(t),Key:Array.from(e),Artist:a,Title:n,Album:r,Filename:o,Format:i})}).then().catch()}async function _(e,t,a){try{const n=await fetch("https://stats.ixarea.com/collect/qmcmask/query",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Format:a,Key:Array.from(e),Filename:t})});let r=await n.json();return m(r.Matrix58,r.Super58A,r.Super58B)}catch(n){}}async function k(e,t,a){let r,o="https://c.y.qq.com/soso/fcgi-bin/client_search_cp?n=10&new_json=1&w="+encodeURIComponent(e+" "+t+" "+a),i=void 0;try{r=await Object(n["j"])(o,"callback"),i=r["data"]["song"]["list"][0]}catch(c){console.error(c)}console.log(i);let s="";return void 0!==i&&void 0!==i["album"]&&(void 0!==i["album"]["pmid"]?s="https://y.gtimg.cn/music/photo_new/T002M000"+i["album"]["pmid"]+".jpg":void 0!==i["album"]["id"]&&(s="https://imgcache.qq.com/music/photo/album/"+i["album"]["id"]%100+"/albumpic_"+i["album"]["id"]+"_0.jpg")),s}},bd2e:function(e,t,a){"use strict";a.r(t),a.d(t,"CommonDecrypt",(function(){return s}));a("baa5"),a("e6cf");const n=a("dde9"),r=a("b6cf"),o=a("fd2f"),i=a("a8ee");async function s(e){let t,a=e.name.substring(e.name.lastIndexOf(".")+1,e.name.length).toLowerCase(),s=e.name.substring(0,e.name.lastIndexOf("."));switch(a){case"ncm":t=await n.Decrypt(e.raw,s,a);break;case"mp3":case"flac":case"m4a":case"ogg":t=await o.Decrypt(e.raw,s,a);break;case"tm0":case"tm3":t=await o.Decrypt(e.raw,s,"mp3");break;case"qmc3":case"qmc2":case"qmc0":case"qmcflac":case"qmcogg":case"tkm":case"bkcmp3":case"bkcflac":case"mflac":case"mgg":t=await r.Decrypt(e.raw,s,a);break;case"tm2":case"tm6":t=await i.Decrypt(e.raw,s);break;default:t={status:!1,message:"不支持此文件格式"}}return t.rawExt=a,t.rawFilename=s,t}},bfa2:function(e,t,a){var n=a("3d67"),r=["CommonDecrypt"];e.exports=function(){var e=new Worker(a.p+"1350ace9da614ffd80e3.worker.js",{name:"[hash].worker.js"});return n(e,r),e}},dde9:function(e,t,a){"use strict";a.r(t),a.d(t,"Decrypt",(function(){return s}));a("c975"),a("e260"),a("fb6a"),a("ace4"),a("e6cf"),a("25f0"),a("5319"),a("5cc6"),a("b39a"),a("ddb0"),a("2b3d");var n=a("06dc");const r=a("3452"),o=r.enc.Hex.parse("687a4852416d736f356b496e62617857"),i=r.enc.Hex.parse("2331346C6A6B5F215C5D2630553C2728");async function s(e,t,a){const r=await Object(n["d"])(e),o=new DataView(r);if(1313166403!==o.getUint32(0,!0)||1296122950!==o.getUint32(4,!0))return{status:!1,message:"此ncm文件已损坏"};const i=c(o,r,10),s=l(i.data),d=u(o,r,i.offset),f=d.data;let m=d.offset+o.getUint32(d.offset+5,!0)+13,p=new Uint8Array(r,m);for(let n=0;n<p.length;++n)p[n]^=s[255&n];void 0===f.album&&(f.album="");const h=[];f.artist&&f.artist.forEach(e=>h.push(e[0]));const b=Object(n["e"])(h.join(" & "),f.musicName,t);0===h.length&&h.push(b.artist),void 0===f.format&&(f.format=Object(n["b"])(p,"mp3"));const g=await Object(n["g"])(f.albumPic);"mp3"===f.format&&(p=await Object(n["k"])(p,h,b.title,f.album,g.buffer,f.albumPic));const w=n["a"][f.format],y=new Blob([p],{type:w});return{status:!0,title:b.title,artist:b.artist,ext:f.format,album:f.album,picture:g.url,file:URL.createObjectURL(y),mime:w}}function c(e,t,a){const n=e.getUint32(a,!0);a+=4;const i=new Uint8Array(t,a,n).map(e=>100^e);a+=n;const s=r.AES.decrypt({ciphertext:r.lib.WordArray.create(i)},o,{mode:r.mode.ECB,padding:r.pad.Pkcs7}),c=new Uint8Array(s.sigBytes),l=s.words,u=s.sigBytes;for(let r=0;r<u;r++)c[r]=l[r>>>2]>>>24-r%4*8&255;return{offset:a,data:c.slice(17)}}function l(e){const t=new Uint8Array(Array(256).keys()),a=e.length;let n=0;for(let r=0;r<256;r++)n=t[r]+n+e[r%a]&255,[t[r],t[n]]=[t[n],t[r]];return t.map((e,t,a)=>{t=t+1&255;const n=a[t],r=a[t+n&255];return a[n+r&255]})}function u(e,t,a){const n=e.getUint32(a,!0);if(a+=4,0===n)return{data:{},offset:a};const o=new Uint8Array(t,a,n).map(e=>99^e);a+=n;const s=r.AES.decrypt({ciphertext:r.enc.Base64.parse(r.lib.WordArray.create(o.slice(22)).toString(r.enc.Utf8))},i,{mode:r.mode.ECB,padding:r.pad.Pkcs7}).toString(r.enc.Utf8),c=s.indexOf(":");let l=JSON.parse(s.slice(c+1));return"dj"===s.slice(0,c)&&(l=l.mainMusic),l.albumPic=l.albumPic.replace("http:","https:"),{data:l,offset:a}}},f1ab:function(e,t,a){"use strict";var n=a("fae0"),r=a.n(n);r.a},fae0:function(e,t,a){},fd2f:function(e,t,a){"use strict";a.r(t),a.d(t,"Decrypt",(function(){return o}));a("e260"),a("ace4"),a("e6cf"),a("5cc6"),a("b39a"),a("ddb0"),a("2b3d");var n=a("06dc");const r=a("cb96");async function o(e,t,a,o=!0){let i=a;if(o){const t=new Uint8Array(await Object(n["d"])(e));i=Object(n["b"])(t,a),i!==a&&(e=new Blob([t],{type:n["a"][i]}))}const s=await r.parseBlob(e),c=Object(n["e"])(s.common.artist,s.common.title,t);return{status:!0,title:c.title,artist:c.artist,ext:i,album:s.common.album,picture:Object(n["f"])(s),file:URL.createObjectURL(e),mime:n["a"][i]}}}});